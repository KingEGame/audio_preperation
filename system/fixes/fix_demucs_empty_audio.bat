@echo off
echo ============================================================
echo ФИКС ПРОБЛЕМЫ С ПУСТЫМ АУДИО ПОСЛЕ DEMUCS
echo ============================================================

echo.
echo Проблема: Demucs полностью удаляет все звуки, оставляя только шум
echo Решение: Добавлены новые режимы обработки и проверки качества
echo.

cd /d "%~dp0..\.."

echo Проверка текущей настройки...
if not exist "system\scripts\audio\stages.py" (
    echo ERROR: Модуль audio не найден!
    pause
    exit /b 1
)

echo.
echo ФИКС УЖЕ ПРИМЕНЕН
echo.
echo Что было исправлено:
echo.
echo 1. Добавлены новые режимы деноизинга:
echo    - 'vocals' - только вокалы (по умолчанию)
echo    - 'no_vocals' - без вокалов
echo    - 'all' - все источники вместе
echo    - 'enhanced' - улучшенное аудио (вокалы + немного фона)
echo.
echo 2. Добавлены проверки качества:
echo    - Проверка громкости исходного аудио
echo    - Проверка громкости результата
echo    - Автоматическая нормализация тихого аудио
echo    - Возврат оригинала если результат слишком тихий
echo.
echo 3. Улучшена обработка результатов:
echo    - Правильное извлечение разных компонентов
echo    - Нормализация громкости
echo    - Ограничение максимальной громкости
echo.

echo Текущие настройки:
echo - Режим по умолчанию: 'enhanced' (лучшее качество)
echo - Автоматическая проверка качества
echo - Возврат оригинала при проблемах
echo.

echo Для тестирования разных режимов запустите:
echo system\fixes\test_demucs_modes.bat
echo.

echo ============================================================
echo ФИКС ПРИМЕНЕН УСПЕШНО
echo ============================================================
echo.
echo Теперь деноизинг должен работать корректно:
echo - Сохраняется голос и музыка
echo - Удаляется только шум
echo - Качество аудио улучшается
echo.
echo Если проблема остается, попробуйте:
echo 1. Запустить тест режимов
echo 2. Изменить режим на 'all' или 'vocals'
echo 3. Проверить качество исходного аудио
echo.
pause 